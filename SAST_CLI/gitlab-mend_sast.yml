# add SAST_ORGANIZATION and SASTCLI_TOKEN as an environment variable - https://gitlab.com/help/ci/variables/README
default:
  image: ubuntu:latest

stages:
  - scan

mend_sast_scan:
  stage: scan
  variables:
    MEND_SAST_ORGANIZATION: $MEND_SAST_ORGANIZATION
    MEND_SAST_API_TOKEN: $MEND_SAST_API_TOKEN
    MEND_SAST_SERVER_URL: "https://saas.mend.io/sast/"
  script: |
    apt update && apt install -y curl
    echo "Downloading Mend SAST Tool"
    curl -LJO https://downloads-sast.mend.io/sast-cli/linux/mendsastcli && chmod +x mendsastcli
    echo "Run Mend SAST"
    ./mendsastcli --dir ./ --name=$CI_PROJECT_NAME-$CI_COMMIT_BRANCH --app=$CI_PROJECT_NAME
